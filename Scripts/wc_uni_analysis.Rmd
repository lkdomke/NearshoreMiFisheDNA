---
title: "wc_uni_analysis"
output: html_document
date: "2025-04-02"
editor_options: 
  chunk_output_type: console
---

# libraries
```{r}
library(tidyverse)
library(lubridate)
library(ggrepel)
library(patchwork)
```

# custom fxn
```{r theme settings, include=FALSE}
# Creates custom base plot theme that can adjust every graph that you use plot_theme for!

plot_theme <- function() {
  theme_bw(base_size = 20, base_family = "Calibri") %+replace%
    theme(panel.background  = element_blank(),
            plot.background = element_rect(fill="white", colour=NA), 
            legend.background = element_rect(fill="transparent", colour=NA),
            legend.key = element_rect(fill="transparent", colour=NA),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            strip.background = element_rect(colour = "NA", fill = "grey96"))
}

# to use ggsave and export plots include argument 'device=cario_pdf' e.g.: 
# ggsave("name.pdf", device=cairo_pdf, width = 6, height = 6)

plot_theme_small <- function() {
  theme_bw(base_size = 18, base_family = "Calibri") %+replace%
    theme(panel.background  = element_blank(),
            plot.background = element_rect(fill="white", colour=NA), 
            legend.background = element_rect(fill="transparent", colour=NA),
            legend.key = element_rect(fill="transparent", colour=NA),
            panel.grid.major = element_blank(), 
            panel.grid.minor = element_blank(),
            strip.background = element_rect(colour = "NA", fill = "grey96"))
}


plot_theme_bw <- function() {
  theme_bw(base_size = 20, base_family = "Calibri") %+replace%
    theme(panel.background  = element_blank(),
            plot.background = element_rect(fill="white", colour=NA), 
            legend.background = element_rect(fill="transparent", colour=NA),
            legend.key = element_rect(fill="transparent", colour=NA),
            # panel.grid.major = element_blank(), 
            # panel.grid.minor = element_blank(),
            strip.background = element_rect(colour = "NA", fill = "grey96"))
}
```


# data
```{r}
wide <- read.csv("Data/combined_gears_wcomm-4-2-25.csv") # this is a combined dataset of eDNA simple means fromtehcnical read proportions for all taxa. Beach seine data is transformed from abundance cpue data to proportional data, 
# * question do we want to do these calculations on proportional data? We must have to*
# should we be using a binomial response, is it zero inflated?  
long <- read.csv("Data/combined_gear_wcomm_long_4-2-25.csv")
site.info2 <- read.csv("Data/combined_metadata_4-2-25.csv")
# read in species table
# life history characteristics
lhs <- read.csv("Data/NearshoreLHSCharacteristics.csv") %>%
  mutate(Scientific.name = str_trim(Scientific.name, side = "right")) %>%
  mutate(Scientific.name = ifelse(Scientific.name == "Apodicthys flavidus",
                                  "Apodichthys flavidus", Scientific.name)) %>%
  mutate(Pelagic.Demersal = str_trim(Pelagic.Demersal, side = "right"))

```

Join in lhs traits to csv table
```{r}
long.lhs <- long %>%
  left_join(lhs, by = c("name" = "Scientific.name")) %>%
  dplyr::rename("common" = Common.name,
                "schooling" = Schooling.,
                "water_hab" = Pelagic.Demersal,
                "scale" = Scale.Type) %>%
  dplyr::select(-c(X, Citation, Notes))

head(long.lhs)
# what are the groups: 
unique(long.lhs$schooling) # n = 3
unique(long.lhs$scale) # n = 5
unique(long.lhs$water_hab) # n = 3

long.lhs %>%
  group_by(scale, schooling, water_hab, type, habitat) %>%
  dplyr::summarize(sum = sum(value)) %>%
  arrange(-sum)# 13 groups for just the lhs characterisitcs, type makes it 26, plus hab make it 78 groups
```

